# FPGA_VA
Accelerate your verificiation modeling through FPGA

# Руководство по настройке хоста

## Автозагрузка модулей

Для автозагрузки, необходимо создать файл `/etc/systemd/system/xdma.service` со следующим содержимым:


```text
[Unit]
Description=Load xdma kernel module

[Service]
Type=simple
RemainAfterExit=yes
ExecStart=/tools/xdma/load_driver.sh 1
TimeoutStartSec=0

[Install]
WantedBy=default.target
```

При этом ожидается, что скрипт по загрузке модуля будет находиться в папке `/tools/xdma/`. В идеале, туда же стоит скопировать и сам модуль ядра (прописав в скрипте `load_driver.sh` абсолютные пути до модуля во всех строках с `insmod`).

После чего, необходимо включить созданный сервис (начнет работать после перезагрузки):

```bash
systemctl enable xdma.service
```

## Права для устройств /dev/xdma*

Изначально, устройства принадлежат пользователю и группе `root`, что вынуждает запускать ПО с правами суперпользователя, что является плохой идеей. Вообще говоря, в исходном коде драйвера прописано, чтобы владельцем модуля была группа xdma, остается только добавить эту подержку со стороны хоста. Для этого необходимо:

Добавить саму группу в систему и текущего пользователя (потребуется перезагрузка):

```
addgroup xdma
usermod -a -G xdma <username>
```

Создать файл `/etc/udev/rules.d/60-xdma.rules` со следующим содержимым:

```
SUBSYSTEM=="xdma" GROUP="xdma"
```

С этого момента, устройства /dev/xdma* будут принадлежать группе `xdma`, а пользователи входящие в эту группу, смогут использовать эти устройства в своих приложениях без повышения привилегий.

## Использование разделяемой библиотеки

В случае, если ПО собирается с использованием разделяемых библиотек, на этапе запуска может происходить ошибка из-за того, что библиотека не была найдена. Для решения проблемы, добавить путь до папки, где хранится библиотека в переменную среды update `LD_LIBRARY_PATH` (если это делается на постоянной основе, лучше добавить этот экспорт в файл `~/.bashrc`).
